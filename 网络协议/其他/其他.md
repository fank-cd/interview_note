# 其他
DNS
  1. DNS：根据域名查出IP地址的一种协议，工作在应用层
  2. 域名层级：


    1. 网站的域名排序是由低到高的
    * 例：[www.example.com](http://www.example.com/) 真正域名是[www.example.com.root](http://www.example.com.root/) (其中.root就是根域名)
    * 根域名的下一级叫做顶级域名，例如.com\\.net
    * 顶级域名的下一级叫做次级域名，这一级是用户可以注册的
    * 次级域名的下一级是主机名，又称三级域名。比如www
    * 主机名.次级域名.顶级域名.根域名 即host.sld.tld.root
  1. 基本流程
    1. 客户机提出域名解析请求，通过UDP协议发送给本地的域名服务器
    2. 本地域名服务器收到请求后，先查询本地缓存记录，如果有，直接返回
    3. 如果没有该记录，则本地域名服务器直接把请求发给根域名服务器，然后根域名服务器再返回给本地域名服务器一个所查询域 (根的子域) 的主域名服务器的地址
    4. 本地服务器再向上一步返回的域名服务器发送请求 , 然后接受请求的服务器查询自己的缓存 , 如果没有该纪录 , 则返回相关的下级的域名服务器的地址
    5. 重复步骤，直到找到正确的记录
    6. 本地域名服务器把返回结果保存到缓存，同时将结果返回给客户机
    7. （以上为迭代查询，递归查询则为根域名服务器代替客户机向下一级子 域发起请求查询，最后返回给客户机）
  2. 递归查询与迭代查询
    * 递归查询 : 如果主机所询问的本地域名服务器不知道被查询的域名的 IP 地址 , 那么本地域名服务器就以 DNS 客户的身份 , 向其它根域名服务器继续发出查询请求报文 (即替主机继续查询) , 而不是让主机自己进行下一步查询 ; 因此 , 递归查询返回的查询结果或者是所要查询的 IP 地址 , 或者是报错 , 表示无法查询到所需的 IP 地址 ;
      * 主机向本地域名服务器的查询一般都是采用 递归查询 ;
    * 迭代查询 : 当根域名服务器收到本地域名服务器发出的迭代查询请求报文时 , 要么给出所要查询的IP地址 , 要么告诉本地服务器 : "你下一步应当向哪一个域名服务器进行查询" ; 然后让本地服务器进行后续的查询 ; 根域名服务器通常是把自己知道的顶级域名服务器的 IP 地址告诉本地域名服务器 , 让本地域名服务器再向顶级域名服务器查询 ; 顶级域名服务器在收到本地域名服务器的查询请求后 , 要么给出所要查询的 IP 地址 , 要么告诉本地服务器下一步应当向哪一个权限域名服务器进行查询 ; 最后 , 知道了所要解析的 IP 地址或报错 , 然后把这个结果返回给发起查询的主机 ;
      * 本地域名服务器向根域名服务器的查询的 迭代查询 ;
  3. DNS劫持：DNS劫持即通过某种技术手段，篡改正确域名和IP地址的映射关系，使得域名映射到了错误的IP地址，因此可以认为DNS劫持是一种DNS重定向攻击
    * 本地DNS劫持：客户端侧发生的DNS劫持统称为本地DNS劫持
    * DNS解析路径劫持：DNS解析过程中发生在客户端和DNS服务器网络通信时的DNS劫持统一归类为DNS解析路径劫持
      * DNS请求转发：通过技术手段(中间盒子，软件等)将DNS流量重定向到其他DNS服务器
      * DNS请求复制：利用分光等设备将DNS查询复制到网络设备，并先于正常应答返回DNS劫持的结果。
      * DNS请求代答：网络设备或者软件直接代替DNS服务器对DNS查询进行应答。
    * 篡改DNS权威记录 我们这里指的黑客非法入侵DNS权威记录管理账号，直接修改DNS记录的行为。
  4. 为什么DNS使用UDP协议
    * DNS 查询的数据包较小、机制简单；
    * UDP 协议的额外开销小、有着更好的性能表现；




* * *
从输入 URL 到展现页面的全过程


  1. URL输入
  2. DNS解析
  3. TCP连接
  4. 发送请求
  5. 服务器处理请求
  6. 服务器响应请求
  7. 浏览器解析渲染页面
  8. 连接结束






  1. DNS解析：网址到IP的过程
    1. 查找顺序： 浏览器缓存--> 操作系统缓存--> 本地host文件 --> 路由器缓存--> ISP DNS缓存 --> 顶级DNS服务器/根DNS服务器
  2. TCP连接： 拿到域名对应的IP地址之后，浏览器会以一个随机端口（1024<端口<65535）向服务器的WEB程序（常用的有httpd,nginx等）80端口发起TCP的连接请求，到达WEB程序，最终建立了TCP/IP的连接。
    1. 三次握手
  3. 发送请求：
    1. 请求报文
      1. 请求行：请求方法、URL、协议版本
      2. 请求头：Host（表示主机名）/Connection,HTTP/1.1/ User-Agent 等等
      3. 请求体：可以承载多个请求参数的数据，包含回车符、换行符和请求数据，并不是所有请求都具有请求数据
  4. 服务器处理请求：nginx->WSGI->Django
  5. 服务器响应请求
    1. 响应报文
      1. 状态行
      1. 响应头(Response Header)
      2. 响应正文
  6. 浏览器渲染页面：
    1. 根据 HTML 解析出 DOM 树
    2. 根据 CSS 解析生成 CSS 规则树
    3. 结合 DOM 树和 CSS 规则树，生成渲染树
    4. 根据渲染树计算每一个节点的信息
    5. 根据计算好的信息绘制页面
  7. 断开连接 四次挥手






* * *


OSI 七层模型
  1. 物理层（Physical Layer）在局部局域网上传送数据帧（Data Frame），它负责管理电脑通信设备和网络媒体之间的互通。包括了针脚、电压、线缆规范、集线器、中继器、网卡、主机接口卡等。
  2. 数据链路层（Data Link Layer）负责网络寻址、错误侦测和改错。当表头和表尾被加至数据包时，会形成信息框（Data Frame）。数据链表头（DLH）是包含了物理地址和错误侦测及改错的方法。数据链表尾（DLT）是一串指示数据包末端的字符串。例如以太网、无线局域网（Wi-Fi）和通用分组无线服务（GPRS）等。
  3. 网络层（Network Layer）决定数据的路径选择和转寄，将网络表头（NH）加至数据包，以形成报文。网络表头包含了网络资料。例如:互联网协议（IP）等。
  4. 传输层（Transport Layer）把传输表头（TH）加至数据以形成数据包。传输表头包含了所使用的协议等发送信息。例如:传输控制协议（TCP）等。
  5. 会话层（Session Layer）负责在数据传输中设置和维护计算机网络中两台计算机之间的通信连接。
  6. 表示层（Presentation Layer）把数据转换为能与接收者的系统格式兼容并适合传输的格式。
  7. 应用层（Application Layer）提供为应用软件而设计的接口，以设置与另一应用软件之间的通信。例如：HTTP、HTTPS、FTP、Telnet、SSH、SMTP、POP3等。






* * *


TCP/IP网络模型：TCP/IP模型是互联网的基础，它是一系列网络协议的总称。这些协议可以划分为四层，分别为链路层、网络层、传输层和应用层。
  * 链路层：负责封装和解封装IP报文，发送和接受ARP/RARP报文等。
  * 网络层：负责路由以及把分组报文发送给目标网络或主机。
  * 传输层：负责对报文进行分组和重组，并以TCP或UDP协议格式封装报文。
  * 应用层：负责向用户提供应用程序，比如HTTP、FTP、Telnet、DNS、SMTP等。、




各层级数据示意：
![noteattachment1][0eea845e84e5e275688f70afbaf4b7fd]




OSI七层模型| TCP/IP模型| 对应网络协议
---|---|---
应用层| 应用层| HTTP、TFTP、SMTP
表示层| Telnet、SNMP
会话层| DNS
传输层| 传输层| TCP、UDP
网络层| 网络层| IP、ICMP、ARP、RARP
数据链路层| 数据链路层| Ethernet、FDDI
物理层| IEEE802.1A \IEEE802.2-IEEE802.11




* * *


ARP和RARP
  * ARP：地址解析协议（Address Resolution Protocol，ARP）是在仅知道主机的IP地址时确地址解析协议定其物理地址的一种协议。
  * 工作原理：
    * 同一网段下，主机A需要向某一IP地址通信，先查看自己的arp缓存，缓存中没有则发送arp包
    * 主机A广播一个ARP请求包，包中有需要知道MAC地址的主机的IP
    * 同一网段下所有主机都会接受请求，IP是自己则加入自己的MAC地址后应答，不是则丢弃
    * A得到ARP应答后，将B的MAC地址放入本机缓存，便于下次使用。
  * RARP：反向地址转换协议（RARP：Reverse Address Resolution Protocol） 反向地址转换协议（RARP）允许局域网的物理机器从网关服务器的 ARP 表或者缓存上请求其 IP 地址。
  * RARP工作原理：
    * 将源设备和目标设备的MAC地址字段都设为发送者的MAC地址和IP地址，发送主机发送一个本地的RARP广播，能够到达网络上的所有设备，在此广播包中，声明自己的MAC地址并且请求任何收到此请求的RARP服务器分配一个IP地址；
    * 本地网段上的RARP服务器收到此请求后，检查其RARP列表，查找该MAC地址对应的IP地址；
    * 如果存在，RARP服务器就给源主机发送一个响应数据包并将此IP地址提供给对方主机使用；如果不存在，RARP服务器对此不做任何的响应；
    *  源主机收到从RARP服务器的响应信息，就利用得到的IP地址进行通讯；如果一直没有收到RARP服务器的响应信息，表示初始化失败。





---
### ATTACHMENTS
[0eea845e84e5e275688f70afbaf4b7fd]: media/2021-03-03_17-39-58.jpg
[2021-03-03_17-39-58.jpg](media/2021-03-03_17-39-58.jpg)
---
### NOTE ATTRIBUTES
>Created Date: 2021-03-03 17:39:58
>Last Evernote Update Date: 2021-03-03 18:19:26
>author: 一的平方
>source: desktop.win
>source-application: yinxiang.win32